<!DOCTYPE html>
<html>
<head>
  <title>Spotify Integration</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script>
</head>
<body>
  <div id="container">
    <h1>Spotify Integration</h1>
    <div id="authorizationSection">
      <button id="connectButton">Connect to Spotify</button>
    </div>
    <div id="loggedInSection" style="display: none;">
      <button id="showLastSongButton">Show Last Song</button>
      <button id="logoutButton">Log Out</button>
      <div id="lastPlayedSong"></div>
    </div>
  </div>
  <script>
    // Set your Spotify Client ID and Client Secret
    const clientId = 'afa1b23fa74b4874ac2b2fbc1ad27943';
    const clientSecret = '71c4b5a213b446c5a834a7c10c5bd738';
    const redirectUri = `https://barbiexsofia.github.io/spotify_integration/spotify_integration.html`;

    // Step 1: Check if the user is already authorized
    const accessToken = localStorage.getItem('accessToken');
    if (accessToken) {
      // User is authorized, show the logged-in section
      document.getElementById('authorizationSection').style.display = 'none';
      document.getElementById('loggedInSection').style.display = 'block';
    }

    // Step 2: Handle the callback after user authentication
    function handleCallback() {
      // Rest of your code
    }

    // Step 3: Get the user's recently played tracks
    function getRecentlyPlayedTracks(accessToken) {
      // Rest of your code
    }

    // Call the authenticateUser function when the "Connect to Spotify" button is clicked
    document.getElementById('connectButton').addEventListener('click', authenticateUser);

    // Call the handleCallback function on the callback page after Spotify authentication
    handleCallback();

    // Show the last played song when "Show Last Song" button is clicked
    document.getElementById('showLastSongButton').addEventListener('click', () => {
      const accessToken = localStorage.getItem('accessToken');
      if (accessToken) {
        getRecentlyPlayedTracks(accessToken);
      }
    });

    // Log out the user when "Log Out" button is clicked
    document.getElementById('logoutButton').addEventListener('click', () => {
      localStorage.removeItem('accessToken');
      localStorage.removeItem('refreshToken');
      location.reload();
    });
  </script>
</body>
</html>